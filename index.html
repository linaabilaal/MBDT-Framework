<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Digital Twin Use Cases</title>
  <style>
    :root{
      --bg:#f6f8fb; --surface:#ffffff; --ink:#0f172a; --muted:#5b677c; --border:#e2e8f0;
      --accent:#2563eb; --accent-quiet:#eff6ff; --ring:rgba(37,99,235,.22);
      --shadow-sm:0 1px 2px rgba(2,6,23,.06); --shadow-md:0 10px 30px rgba(2,6,23,.08);
      --radius:14px; --radius-lg:16px; --container:1200px;
      --space-1:6px; --space-2:10px; --space-3:14px; --space-4:18px; --space-5:22px;
      font-family: sans-serif;
    }
    
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: sans-serif; color:var(--ink); background:var(--bg); -webkit-font-smoothing:antialiased}
    h1,h2,h3{margin:0; font-family: sans-serif; letter-spacing:-.01em}
    h1{font-weight:800; font-size:clamp(22px,3.2vw,28px)}
    h2{font-weight:750; font-size:18px}
    h3{font-weight:700; font-size:15px}
    p{margin:0}
    a{color:inherit; text-decoration:none}

    /* Layout */
    .shell{max-width:var(--container); margin:0 auto; display:grid; grid-template-columns:280px 1fr; gap:var(--space-4); padding:var(--space-4)}
    header.site{position:sticky; top:0; z-index:50; backdrop-filter:blur(6px); background:color-mix(in oklab, var(--surface) 92%, transparent); border-bottom:1px solid var(--border)}
    .head{max-width:var(--container); margin:0 auto; padding:var(--space-3) var(--space-4)}
    .title{font-weight:800; font-size:clamp(20px,3vw,26px); font-family: sans-serif;}

    /* Sidebar (vertical tabs) */
    .side{position:sticky; top:88px; align-self:start; background:var(--surface); border:1px solid var(--border); border-radius:var(--radius-lg); box-shadow:var(--shadow-sm)}
    .usecase-list{list-style:none; padding:8px; margin:0; font-family: sans-serif;}
    .usecase-item{margin:4px 0}
    .usecase-btn{font-family: sans-serif;width:100%; display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px solid transparent; background:transparent; color:var(--ink); border-radius:10px; cursor:pointer; font-weight:700}
    .usecase-btn:hover{background:color-mix(in oklab, var(--surface) 90%, var(--bg) 10%)}
    .usecase-btn[aria-current="true"]{font-family: sans-serif;background:var(--surface); border-color:color-mix(in oklab, var(--border) 60%, var(--accent) 40%); box-shadow:var(--shadow-sm)}
    .dot{width:8px; height:8px; border-radius:999px; background:var(--accent)}

    /* Hero banner */
    .hero{background:var(--surface); border:1px solid var(--border); border-radius:12px; overflow:hidden; box-shadow:var(--shadow-sm)}
    .hero-img{display:block; width:100%; max-height:360px; object-fit:contain; background:var(--surface)}

    /* Section blocks */
    .section{background:var(--surface); border:1px solid var(--border); border-radius:var(--radius-lg); overflow:hidden; margin-top:var(--space-4); box-shadow:var(--shadow-sm)}
    .section-header{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px 14px; border-bottom:1px solid var(--border); background:color-mix(in oklab, var(--surface) 96%, var(--bg) 4%)}
    .section-header h2>a{border-bottom:1px dashed transparent}
    .section-header h2>a:focus-visible, .section-header h2>a:hover{border-bottom-color:var(--accent)}

    /* Subheaders with info tooltip */
    .sub{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px 14px; border-bottom:1px solid var(--border); background:var(--surface)}
    .sub-left{display:flex; align-items:center; gap:10px}
    .info-btn{display:inline-flex; align-items:center; gap:6px; padding:6px 8px; font-size:12px; border:1px solid var(--border); background:color-mix(in oklab,var(--surface) 88%, var(--bg) 12%); color:var(--ink); border-radius:999px; cursor:pointer; position:relative}
    .info-btn:hover{background:color-mix(in oklab,var(--surface) 82%, var(--bg) 18%)}
    .info-btn:focus-visible{outline:none; box-shadow:0 0 0 3px var(--accent-quiet),0 0 0 1px var(--accent)}
    .info-btn .icon{width:16px; height:16px}
    .tooltip{position:absolute; top:calc(100% + 8px); right:0; min-width:260px; max-width:360px; padding:10px 12px; border:1px solid var(--border); background:color-mix(in oklab,var(--surface) 96%, var(--bg) 4%); color:var(--ink); border-radius:10px; box-shadow:var(--shadow-md); font-size:13.5px; line-height:1.45; z-index:40; display:none}
    .tooltip[aria-hidden="false"]{display:block}
    .tooltip p{margin:0; color:var(--muted)}
    .tooltip::after{content:""; position:absolute; top:-6px; right:14px; border-width:6px; border-style:solid; border-color:transparent transparent color-mix(in oklab,var(--surface) 96%, var(--bg) 4%) transparent}
    .tooltip::before{content:""; position:absolute; top:-7px; right:14px; border-width:7px; border-style:solid; border-color:transparent transparent var(--border) transparent}

    /* Grid of figures */
    .grid{display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:var(--space-3); padding:var(--space-3)}
    .card{background:var(--surface); border:1px solid var(--border); border-radius:12px; overflow:hidden; box-shadow:var(--shadow-sm); transition:box-shadow .18s ease, transform .08s ease}
    .card:hover{box-shadow:var(--shadow-md); transform:translateY(-1px)}
    .media{aspect-ratio:16/10; display:grid; place-items:center; background:color-mix(in oklab, var(--surface) 90%, var(--bg) 10%); border-bottom:1px solid var(--border); position:relative}
    .media img, .media video{max-width:92%; max-height:92%; object-fit:contain; border-radius:8px}
    .zoom{position:absolute; bottom:10px; right:10px; padding:6px 8px; font-size:12px; border:1px solid var(--border); background:rgba(255,255,255,.8); backdrop-filter:saturate(1.2) blur(2px); border-radius:999px; cursor:pointer}
    .meta{padding:12px}
    .title-sm{font-weight:750; font-size:14px}
    .caption{margin-top:6px; font-size:12.5px; color:var(--muted)}
    .mono{font-family:Georgia, serif;}

    /* Lightbox */
    .lightbox{position:fixed; inset:0; background:rgba(2,6,23,.62); display:none; align-items:center; justify-content:center; z-index:60}
    .lightbox img, .lightbox video{max-width:92vw; max-height:88vh; border-radius:12px; border:2px solid #fff; box-shadow:0 18px 48px rgba(2,6,23,.45)}

    @media (max-width:980px){ .shell{grid-template-columns:1fr} .side{position:static} }
  </style>
</head>
<body>
  <header class="site" aria-label="Page header">
    <div class="head">
      <div class="title">Digital Twin Use Cases</div>
    </div>
  </header>

  <main class="shell" id="app">
    <!-- Sidebar -->
    <aside class="side" aria-label="Use cases">
      <ul id="uc-list" class="usecase-list" role="tablist" aria-orientation="vertical"></ul>
    </aside>

    <!-- Main content -->
    <div>
      <section class="hero" aria-label="Use case hero">
        <img id="hero-img" class="hero-img" src="" alt="" />
      </section>

      <div id="content"></div>
    </div>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Preview" onclick="closeLightbox(event)">
    <img id="lightbox-img" alt="preview" />
  </div>

  <script>
  const DATA = [
    {
      id: 'vgr', name: 'Vacuum Gripper Robot', hero: 'img/VGR/VGR.png',
      inputs: {
        pt: [
          { t: 'PT Structural Models', src: 'img/VGR/block.png' },
          { t: 'PICK/PLACE Mission State Machine', src: 'img/VGR/mission.png' }
        ],
        dt: [
          { t: 'Configuration Model', src: 'img/VGR/VGR-ConfigUI.png' },
          { t: 'Feature model', src: 'img/VGR/VGR-FM.png' }
        ]
      },
      outputs: {
        monitoring: [ { t: 'Basic Visualization', src: 'img/VGR/VGR-monitoringUI.png' } ],
        anomaly: [ { t: 'Anomaly Detection', type:'video', src:'recording.mp4', poster:'img/VGR/anomaly.png' } ],
        cockpit: [
          { t: 'Cockpit UI  ', src: 'img/VGR/vgr-cockpitUI.png' }
        ],
        digitalShadow: [ { t: 'Digital Shadow w/ InfluxDB', src: 'img/VGR/VGR-DS.png' } ],
        internal: [ { t: 'Models in the DT', src: 'img/VGR/mission.png' } ]
      }
    },
    {
      id: 'conveyor', name: 'Conveyor Belt', hero: 'img/CB/cb.png',
      inputs: {
        pt: [ { t: 'CB Block Diagram', src: 'img/CB/ConveyorBelt-Block.png' } ],
        dt: [
          { t: 'Configuration Model', src: 'img/CB/CB-ConfigUI.png' },
          { t: 'Feature model', src: 'img/CB/CB-FM.png' }
        ]
      },
      outputs: {
        monitoring: [ { t: 'Basic Visualization', src: 'img/CB/CB-MonitoringUI.png' } ],
        anomaly: [  ],
        cockpit: [
          { t: 'Cockpit UI', src: 'img/CB/CB-CockpitUI.png' }
        ],
        digitalShadow: [ { t: 'Digital Shadow', src: 'img/CB/CB-DS.png' } ],
        internal: [ ]
      }
    },
    {
      id: 'turbine', name: 'Steam Turbine', hero: 'img/SM/SM.jpeg',
      inputs: {
        pt: [ { t: 'PT Structural Models', src: 'img/SM/SteamMachine.png' } ],
        dt: [
          { t: 'Configuration file', src: 'img/SM/SM-ConfigUI.png' },
          { t: 'Feature model', src: 'img/SM/SM-FM.png' }
        ]
      },
      outputs: {
        monitoring: [ { t: 'Basic Visualization', src: 'img/SM/SM-MonitoringUI.png' } ],
        anomaly: [ ],
        cockpit: [
          { t: 'Cockpit UI', src: 'img/SM/SM-CockpitUI.png' }
        ],
        digitalShadow: [ { t: 'Digital Shadow', src: 'img/SM/SM-DS.png' } ],
        internal: [  ]
      }
    },
    {
      id: 'home', name: 'Home Assistant', hero: 'img/HA/home-assistant.jpg',
      inputs: {
        pt: [
          { t: 'PT Structural Models', src: 'img/HA/HA-BLOCK.png' },
        ],
        dt: [
          { t: 'Configuration file', src: 'img/HA/HA-ConfigUI.png' },
          { t: 'Feature model', src: 'img/HA/SM-FM.png' }
        ]
      },
      outputs: {
        monitoring: [ { t: '', src: 'img/HA/HA-MonitoringUI.png' } ],
        anomaly: [  ],
        cockpit: [
          { t: 'Cockpit UI  ', src: 'img/HA/HA-CockpitUI.png' }
        ],
        digitalShadow: [ { t: 'Digital Shadow', src: 'img/HA/HA-DS.png' } ],
        internal: [ ]
      }
    }
  ];

  const DESCRIPTIONS = {
    pt: "PT models describe the physical system itself, its structure and behaviour, thus serving as blueprints for building the PT.",
    dt: "DT models describe the twin's architecture (data, models, services, connectivity).",
    monitoring: "Monitoring auto-generates real-time dashboards of PT data.",
    anomaly: "Anomaly detection compares live PT behaviour to modelled expectations and flags deviations.",
    cockpit: "The cockpit exposes model-derived commands and actions, and lets users interact with the PT through the DT.",
    digitalShadow: "The Digital Shadow keeps a time-stamped record of the PT's state for real-time and historical access.",
    internal: "Models in the DT are runtime representations of the PT, used directly by services. In our case, we reuse models of the PT (behavioral or models that describe the commands the PT can issue)."
  };

  // ======= Helpers =========
  const $ = sel => document.querySelector(sel);
  const el = (t, cls) => { const n = document.createElement(t); if(cls) n.className = cls; return n; };

  function openLightbox(src, isVideo=false, poster){
    const lb = $('#lightbox');
    lb.innerHTML = '';
    const node = document.createElement(isVideo ? 'video' : 'img');
    if(isVideo){ node.src = src; if(poster) node.poster = poster; node.controls = true; }
    else { node.src = src; node.alt = 'preview'; }
    node.style.maxWidth = '92vw'; node.style.maxHeight = '88vh'; node.style.borderRadius = '12px';
    lb.appendChild(node); lb.style.display = 'flex';
  }
  function closeLightbox(e){ if(e.target.id === 'lightbox') e.currentTarget.style.display='none'; }

  // Info tooltip
  function infoButton(key){
    const btn = el('button','info-btn');
    btn.type = 'button';
    btn.setAttribute('aria-expanded','false');
    btn.setAttribute('aria-controls', `tip-${key}`);
    btn.innerHTML = `
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="9"></circle>
        <line x1="12" y1="8" x2="12" y2="8"></line>
        <path d="M10.8 12.2h1.2v3.6H12"></path>
      </svg>
      Info`;
    const tip = el('div','tooltip'); tip.id = `tip-${key}`; tip.setAttribute('role','tooltip'); tip.setAttribute('aria-hidden','true');
    const p = el('p'); p.textContent = DESCRIPTIONS[key] || 'No description provided yet.'; tip.appendChild(p);
    btn.onclick = (e)=>{ e.stopPropagation(); const open = btn.getAttribute('aria-expanded')==='true'; btn.setAttribute('aria-expanded', String(!open)); tip.setAttribute('aria-hidden', String(open)); };
    document.addEventListener('click', (evt)=>{ if (tip.getAttribute('aria-hidden')==='false' && !btn.contains(evt.target) && !tip.contains(evt.target)){ btn.setAttribute('aria-expanded','false'); tip.setAttribute('aria-hidden','true'); } });
    document.addEventListener('keydown', (evt)=>{ if (evt.key==='Escape' && tip.getAttribute('aria-hidden')==='false'){ btn.setAttribute('aria-expanded','false'); tip.setAttribute('aria-hidden','true'); btn.focus(); } });
    btn.appendChild(tip);
    return btn;
  }

  // Figure card
  function figureCard(item){
    const card = el('div','card');
    const media = el('div','media');
    if(item.type==='video'){
      const v = document.createElement('video'); v.src = item.src; if(item.poster) v.poster = item.poster; v.controls=true; v.preload='metadata'; media.appendChild(v);
      const z = el('button','zoom'); z.textContent = 'Open'; z.onclick=()=> openLightbox(item.src,true,item.poster); media.appendChild(z);
    } else {
      const img = document.createElement('img'); img.src = item.src; img.alt = item.t; media.appendChild(img);
      const z = el('button','zoom'); z.textContent = 'Open'; z.onclick=()=> openLightbox(item.src); media.appendChild(z);
    }
    const meta = el('div','meta');
    const t = el('div','title-sm'); t.textContent = item.t; meta.appendChild(t);
    const c = el('div','caption'); c.textContent = ''; meta.appendChild(c);
    card.appendChild(media); card.appendChild(meta);
    return card;
  }

  // Subsection block
  function subsection(title, key, anchor){
    const wrapper = document.createDocumentFragment();
    const s = el('div','sub'); s.id = anchor;
    const left = el('div','sub-left'); const h = el('h3'); h.textContent = title; left.appendChild(h); s.appendChild(left);
    s.appendChild(infoButton(key));
    wrapper.appendChild(s);
    return wrapper;
  }

  // Render use case body
  function renderUseCase(uc){
    // hero (image only)
    const hero = $('#hero-img'); hero.src = uc.hero; hero.alt = uc.name;

    const root = $('#content'); root.innerHTML = '';

    // Inputs
    const inputs = el('section','section');
    const ih = el('div','section-header'); ih.innerHTML = `<h2><a id="inputs" href="#inputs">Inputs</a></h2>`; inputs.appendChild(ih);
    inputs.appendChild(subsection('Models of the Physical Twin (PT)','pt','inputs-pt'));
    let grid = el('div','grid'); uc.inputs.pt.forEach(item=> grid.appendChild(figureCard(item))); inputs.appendChild(grid);
    inputs.appendChild(subsection('Models of the Digital Twin (DT)','dt','inputs-dt'));
    grid = el('div','grid'); uc.inputs.dt.forEach(item=> grid.appendChild(figureCard(item))); inputs.appendChild(grid);
    root.appendChild(inputs);

    // Outputs
    const outputs = el('section','section');
    const oh = el('div','section-header'); oh.innerHTML = `<h2><a id="outputs" href="#outputs">Outputs</a></h2>`; outputs.appendChild(oh);

    // Monitoring
    outputs.appendChild(subsection('Monitoring Service','monitoring','out-monitoring'));
    grid = el('div','grid'); uc.outputs.monitoring.forEach(item=> grid.appendChild(figureCard(item))); outputs.appendChild(grid);

    // Anomaly Detection — ONLY for VGR
    if (uc.id === 'vgr') {
      outputs.appendChild(subsection('Anomaly Detection','anomaly','out-anomaly'));
      grid = el('div','grid'); uc.outputs.anomaly.forEach(item=> grid.appendChild(figureCard(item))); outputs.appendChild(grid);
    }

    // Cockpit
    outputs.appendChild(subsection('Cockpit','cockpit','out-cockpit'));
    grid = el('div','grid'); uc.outputs.cockpit.forEach(item=> grid.appendChild(figureCard(item))); outputs.appendChild(grid);

    // Digital Shadow
    outputs.appendChild(subsection('Digital Shadow','digitalShadow','out-ds'));
    grid = el('div','grid'); uc.outputs.digitalShadow.forEach(item=> grid.appendChild(figureCard(item))); outputs.appendChild(grid);

    // Models in the DT — ONLY for VGR
    if (uc.id === 'vgr') {
      outputs.appendChild(subsection('Models in the DT','internal','out-internal'));
      grid = el('div','grid'); uc.outputs.internal.forEach(item=> grid.appendChild(figureCard(item))); outputs.appendChild(grid);
    }

    root.appendChild(outputs);

    // Number captions sequentially within page
    let n = 1; root.querySelectorAll('.caption').forEach(cap=>{ cap.textContent = `Figure ${n++}.`; });
  }

  // Sidebar list
  function renderSidebar(activeId){
    const list = $('#uc-list'); list.innerHTML='';
    DATA.forEach(uc=>{
      const li = el('li','usecase-item');
      const b = document.createElement('button');
      b.className='usecase-btn'; b.type='button';
      b.setAttribute('role','tab');
      b.setAttribute('aria-selected', uc.id===activeId ? 'true':'false');
      b.setAttribute('aria-current', uc.id===activeId ? 'true':'false');
      b.onclick = ()=> selectUC(uc.id);
      b.innerHTML = `<span class="dot" aria-hidden="true"></span><span>${uc.name}</span>`;
      li.appendChild(b); list.appendChild(li);
    });
  }

  // State + URL sync
  const state = { active: (new URLSearchParams(location.search)).get('uc') || DATA[0].id, compact:false };
  function selectUC(id){
    state.active = id;
    const qp = new URLSearchParams(location.search);
    qp.set('uc', id);
    history.replaceState(null, '', `${location.pathname}?${qp.toString()}`);
    boot();
    window.scrollTo({top:0, behavior:'smooth'});
  }

  // Boot
  function boot(){
    const uc = DATA.find(u=>u.id===state.active) || DATA[0];
    renderSidebar(uc.id);
    renderUseCase(uc);
  }
  boot();

  // Basic schema self-check
  (function runSelfTests(){
    const reqOut = ['monitoring','anomaly','cockpit','digitalShadow','internal'];
    let failed = 0;
    if (DATA.length !== 4) failed++;
    DATA.forEach(uc=>{
      if(!uc.inputs || !Array.isArray(uc.inputs.pt) || !Array.isArray(uc.inputs.dt)) failed++;
      reqOut.forEach(k=>{ if(!uc.outputs || !Array.isArray(uc.outputs[k])) failed++; });
    });
    if (failed) console.warn('Self-tests failed:', failed);
  })();
  </script>
</body>
</html>
